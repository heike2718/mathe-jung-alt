<h1>Rätsel</h1>

<ng-container *ngIf="isAdmin">
    <mja-raetsel-suchfilter-admin [selectItemsCompomentModel]="selectItemsCompomentModel"
        (inputChanged)="onSuchfilterSuchstringChanged($event)"
        (selectableItemsChanged)="onSelectItemsCompomentModelChanged($event)"></mja-raetsel-suchfilter-admin>

    <p>Suchkriterien: {{suchfilter | json}}</p>
</ng-container>

<ng-container *ngIf="!isAdmin">
    <mja-select-items [model]="selectItemsCompomentModel"
        (modelChanged)="onSelectItemsCompomentModelChanged($event)"></mja-select-items>
</ng-container>

<div flex fxLayout="row" fxLayoutGap="10px" fxLayout.lt-sm="column" class="mb-2">
    <div fxLayoutAlign="left center" fxFlex="10"><button mat-raised-button color="primary" (click)="neueSuche()"
            [disabled]="buttonNeueSucheDisabled()">neue
            Suche</button></div>

    <ng-container *ngIf="isAdmin">
        <div *ngIf="coreFacade.existsQuelleAdmin$ | async; else keineQuelle" fxLayoutAlign="left center" fxFlex="10">
            <button mat-raised-button color="primary" (click)="neuesRaetsel()">neues
                Rätsel</button>
        </div>
    </ng-container>
    
</div>

<mat-paginator [length]="anzahlRaetsel" [pageSizeOptions]="[20,30,50]" showFirstLastButtons></mat-paginator>

<mat-table [dataSource]="dataSource" class="mat-elevation-z8" matSort matSortActive="schluessel" matSortDirection="asc"
    matSortDisableClear>

    <ng-container matColumnDef="status">
        <mat-header-cell *matHeaderCellDef class="mat-header-cell__1"></mat-header-cell>
        <mat-cell *matCellDef="let raetsel" class="mat-cell__1"><span *ngIf="raetsel.status === 'ERFASST'">
                <mat-icon>block</mat-icon>
            </span>
            <span *ngIf="raetsel.status === 'FREIGEGEBEN'">
                <mat-icon>check_circle_outline</mat-icon>
            </span>
        </mat-cell>
    </ng-container>

    <ng-container matColumnDef="schluessel">
        <mat-header-cell *matHeaderCellDef mat-sort-header
            class="mat-header-cell__2">{{getHeaderSchluessel()}}</mat-header-cell>
        <mat-cell *matCellDef="let raetsel" class="mat-cell__2">{{raetsel.schluessel}}</mat-cell>
    </ng-container>

    <ng-container matColumnDef="name">
        <mat-header-cell *matHeaderCellDef class="mat-header-cell__3">Name</mat-header-cell>
        <mat-cell *matCellDef="let raetsel" class="mat-cell__3"> {{raetsel.name}} </mat-cell>
    </ng-container>

    <ng-container matColumnDef="kommentar">
        <mat-header-cell *matHeaderCellDef class="mat-header-cell__4">Kommentar</mat-header-cell>
        <mat-cell *matCellDef="let raetsel" class="mat-cell__4"> {{raetsel.kommentar}} </mat-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="getDisplayedColumns(); sticky: true"></mat-header-row>
    <mat-row *matRowDef="let row; columns: getDisplayedColumns()" (click)="onRowClicked(row)"></mat-row>

</mat-table>


<ng-template #keineQuelle>
    <div fxLayout="column m-1">
        <div fxFlex="0 1 calc(80%-20px)">
            zuerst als Autor:in eintragen lassen, dann selbst Rätsel erfassen
        </div>
    </div>
</ng-template>